<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.b2.Sinnanda.mapper.HostQnaMapper">
	
	<!-- [이승준] QnA One Map -->
	<resultMap type="com.b2.Sinnanda.vo.HostQna" id="HostQnaOneMap">
		<id column="host_qna_no" property="hostQnaNo"/>
		<result column="host_no" property="hostNo"/>
		<result column="host_name" property="hostName"/>
		<result column="host_qna_category" property="hostQnaCategory"/>
		<result column="host_qna_state" property="hostQnaState"/>
		<result column="host_qna_title" property="hostQnaTitle"/>
		<result column="host_qna_content" property="hostQnaContent"/>
		<result column="host_qna_upload_file" property="hostQnaUploadFile"/>
		<result column="create_date" property="createDate"/>
		<result column="update_date" property="updateDate"/>
		<!--[이승준] Host QnA에 답변한 admin의 이름 -->
		<result column="admin_name" property="adminName"/>
		<!-- [이승준] Host QnA에 대한 답변 -->
		<collection property="hostQnaComments" ofType="com.b2.Sinnanda.vo.HostQnaComment">
			<result column="admin_no" property="adminNo"/>
			<result column="host_qna_comment_content" property="ostQnaCommentContent"/>
			<result column="comment_date" property="commentDate"/>
		</collection>
	</resultMap>
	
	<!-- [이승준] QnA 상세 조회 -->
	<select id="selectHostQnaOne"  parameterType="int" resultMap="HostQnaOneMap">
		SELECT 
			hq.host_qna_no, 
			hq.host_no, 
			h.host_name, 
			hq.host_qna_category,
			hq.host_qna_state, 
			hq.host_qna_title, 
			hq.host_qna_content, 
			hq.host_qna_upload_file, 
			hq.create_date, 
			hq.update_date, 
			hqc.admin_no, 
			a.admin_name, 
			hqc.host_qna_comment_content, 
			hqc.comment_date
		FROM host_qna hq 
		LEFT JOIN host_qna_comment hqc 
			ON hq.host_qna_no = hqc.host_qna_no
		LEFT JOIN host h
			ON hq.host_no = h.host_no
		LEFT JOIN admin a 
			ON hqc.admin_no = a.admin_no
		WHERE hqc.host_qna_no = #{hostQnaNo}
	</select>
	
	<!-- [이승준] Host QnA List Map -->
	<resultMap type="com.b2.Sinnanda.vo.HostQna" id="HostQnaListMap">
		<id column="host_qna_no" property="hostQnaNo"/>
		<result column="host_no" property="hostNo"/>
		<result column="host_qna_category" property="hostQnaCategory"/>
		<result column="host_qna_state" property="hostQnaState"/>
		<result column="host_qna_title" property="hostQnaTitle"/>
		<result column="host_qna_content" property="hostQnaContent"/>
		<result column="host_qna_upload_file" property="hostQnaUploadFile"/>
		<result column="create_date" property="createDate"/>
		<result column="host_name" property="hostName"/>
	</resultMap>
	
	<!-- [이승준] Host QnA 목록 조회 -->
	<select id="selectHostQnaListByHostQnaCategory" parameterType="Map" resultMap="HostQnaListMap">
		SELECT 
			hq.host_qna_no, 
			hq.host_no, 
			hq.host_qna_category,
			hq.host_qna_state, 
			hq.host_qna_title, 
			hq.host_qna_content, 
			hq.host_qna_upload_file, 
			hq.create_date, 
			h.host_name
		FROM host_qna hq LEFT JOIN host h 
			ON hq.host_no = h.host_no
		<where>
			<if test="hostQnaCategory != null">
				hq.host_no = #{hostNo} AND hq.host_qna_category = #{hostQnaCategory}
			</if>
			<if test="hostQnaCategory == null">
				hq.host_no = #{hostNo}
			</if>
		</where>
		ORDER BY create_date DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- [이승준] Host QnA 갯수 조회 -->
	<select id="selectHostQnaTotalCount" resultType="int">
		SELECT 
			COUNT(*) 
		FROM host_qna
	</select>
</mapper>